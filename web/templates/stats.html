{{define "stats.html"}}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統計 - Safari履歴分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    {{template "nav"}}

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
<div class="px-4 py-6 sm:px-0">
    <!-- フィルタ -->
    <div class="bg-white shadow rounded-lg mb-6">
        <div class="px-4 py-5 sm:p-6">
            <form method="GET" action="/stats" class="flex flex-wrap gap-4 items-end">
                <div>
                    <label for="domain" class="block text-sm font-medium text-gray-700">ドメイン</label>
                    <select name="domain" id="domain"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm border px-3 py-2">
                        <option value="">すべて</option>
                        {{range .Domains}}
                        <option value="{{.}}" {{if eq . $.Domain}}selected{{end}}>{{.}}</option>
                        {{end}}
                    </select>
                </div>
                <div>
                    <label for="days" class="block text-sm font-medium text-gray-700">日数</label>
                    <select name="days" id="days"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm border px-3 py-2">
                        <option value="7" {{if eq .Days 7}}selected{{end}}>7日</option>
                        <option value="14" {{if eq .Days 14}}selected{{end}}>14日</option>
                        <option value="30" {{if eq .Days 30}}selected{{end}}>30日</option>
                        <option value="90" {{if eq .Days 90}}selected{{end}}>90日</option>
                    </select>
                </div>
                <button type="submit"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                    適用
                </button>
                <a href="/stats"
                    class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    クリア
                </a>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- 時間帯別統計 -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">時間帯別訪問数</h3>
                <div class="space-y-2">
                    {{$maxHourly := 0}}
                    {{range .HourlyStats}}
                        {{if gt .VisitCount $maxHourly}}
                            {{$maxHourly = .VisitCount}}
                        {{end}}
                    {{end}}
                    {{range .HourlyStats}}
                    <div class="flex items-center">
                        <div class="w-12 text-sm text-gray-600">{{printf "%02d" .Hour}}:00</div>
                        <div class="flex-1 mx-2">
                            <div class="bg-gray-200 rounded-full h-5">
                                {{if gt $maxHourly 0}}
                                <div class="bg-green-500 rounded-full h-5" style="width: {{percentage .VisitCount $maxHourly}}%"></div>
                                {{end}}
                            </div>
                        </div>
                        <div class="w-12 text-right text-sm text-gray-600">{{.VisitCount}}</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- 日別統計 -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">日別訪問数（過去{{.Days}}日間）</h3>
                {{if .DailyStats}}
                <div class="space-y-2">
                    {{$maxDaily := 0}}
                    {{range .DailyStats}}
                        {{if gt .VisitCount $maxDaily}}
                            {{$maxDaily = .VisitCount}}
                        {{end}}
                    {{end}}
                    {{range .DailyStats}}
                    <div class="flex items-center">
                        <div class="w-24 text-sm text-gray-600">{{.Date}}</div>
                        <div class="flex-1 mx-2">
                            <div class="bg-gray-200 rounded-full h-5">
                                {{if gt $maxDaily 0}}
                                <div class="bg-blue-500 rounded-full h-5" style="width: {{percentage .VisitCount $maxDaily}}%"></div>
                                {{end}}
                            </div>
                        </div>
                        <div class="w-12 text-right text-sm text-gray-600">{{.VisitCount}}</div>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <p class="text-gray-500 text-sm">データがありません</p>
                {{end}}
            </div>
        </div>

        <!-- ドメイン別統計 -->
        <div class="bg-white shadow rounded-lg lg:col-span-2">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">ドメイン別訪問数（Top 10）</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {{$maxDomain := 0}}
                    {{range .DomainStats}}
                        {{if gt .VisitCount $maxDomain}}
                            {{$maxDomain = .VisitCount}}
                        {{end}}
                    {{end}}
                    {{range .DomainStats}}
                    <div class="flex items-center">
                        <div class="w-32 truncate text-sm text-gray-600" title="{{.Domain}}">{{.Domain}}</div>
                        <div class="flex-1 mx-2">
                            <div class="bg-gray-200 rounded-full h-5">
                                {{if gt $maxDomain 0}}
                                <div class="bg-purple-500 rounded-full h-5" style="width: {{percentage .VisitCount $maxDomain}}%"></div>
                                {{end}}
                            </div>
                        </div>
                        <div class="w-16 text-right text-sm text-gray-600">{{.VisitCount}}</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</div>
    </main>

    {{template "footer"}}
</body>
</html>
{{end}}
